---
import { getCollection, render } from "astro:content"
import LayoutBlog from "@/layouts/LayoutBlog.astro"

export async function getStaticPaths() {
    const posts = await getCollection('posts');

    return posts.map((post) => ({
        params: { id: post.slug },
        props: { post }
    }))
}

const { post } = Astro.props
const { data } = post
const { title, description, author, date, categories, tags, image } = data

const dateObj = new Date(date)

// Formateamos la fecha al estilo "20 Nov 2025"
const dateFormatted = new Intl.DateTimeFormat('es-ES', {
  day: '2-digit',
  month: 'short',
  year: 'numeric'
}).format(dateObj);

const { Content } = await render(post)
---

<LayoutBlog title={title} description={description}>
    <main class="px-4 py-12 md:py-24">
        <article class="mx-auto max-w-3xl">
            <!-- Header -->
            <header class="mb-8">
                <div class="flex flex-wrap items-center gap-3 mb-4">
                    {
                        categories?.map(category => {
                            return(
                                <a href=`/blog/categories/${category}` class="inline-block text-xs font-medium uppercase tracking-wide px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700">
                                    {category}
                                </a>
                            )
                        })
                    }           
                </div>

                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 dark:text-white leading-tight">{title}</h1>
                <p class="mt-3 text-lg text-gray-600 dark:text-gray-300">{description}</p>

                <div class="mt-4 flex flex-wrap items-center gap-3 text-sm text-gray-500 dark:text-gray-400">              
                    <time datetime={dateObj.toISOString()} class="text-gray-400">{dateFormatted}</time>
                    <span aria-hidden="true">Â·</span>
                    <span class="flex items-center gap-1">ðŸ•‘ <span class="text-gray-600 dark:text-gray-300">Lect. 2 min</span></span>
                </div>
            </header>

            <!-- Hero image -->
            <figure class="w-full overflow-hidden rounded-xl shadow-md">
                <img src=`/${image.path}` alt={title} class="w-full h-64 md:h-96 object-cover"/>
            </figure>

            <!-- Content -->
            <div class="post-content mt-8">
                <div class="mt-8 prose prose-lg dark:prose-invert prose-img:rounded-xl prose-img:shadow-lg max-w-none">
                    <Content />
                </div>
            </div>

        </article>
    </main>

</LayoutBlog>
