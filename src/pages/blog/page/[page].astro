---
import LayoutBlog from "@/layouts/LayoutBlog.astro";
import BlogPostGrid from "@/components/blog/BlogPostGrid.astro";
import { getCollection } from "astro:content";

const POSTS_PER_PAGE = 9;

export async function getStaticPaths() {
  const POSTS_PER_PAGE = 9;
  const all = await getCollection("posts");
  const pages = Math.ceil(all.length / POSTS_PER_PAGE) || 1;
  return Array.from({ length: pages }, (_, i) => ({ params: { page: String(i + 1) } }));
}

const { page } = Astro.params;
const currentPage = Math.max(1, Number(page || 1));

const allPosts = (await getCollection("posts"))
  .slice()
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE) || 1;
const start = (currentPage - 1) * POSTS_PER_PAGE;
const pagePosts = allPosts.slice(start, start + POSTS_PER_PAGE);
---

<LayoutBlog title={`Multivacs Blog - Data Scientist y Machine Learning con +3 años de experiencia - Página ${currentPage}`} description="Blog dedicado a la ciencia de datos y la tecnología aplicada a diversos campos como la industria, los videojuegos o la física; y cómo poner el poder de los datos a nuestra disposición.">
  <main class="p-4 max-w-screen-xl mx-auto mt-8">

    <BlogPostGrid posts={pagePosts} title={`Últimos posts`} />


    <nav class="flex justify-center gap-2 mt-6" aria-label="Paginación">
      {currentPage > 1 && <a class="px-3 py-2 rounded bg-gray-200 text-gray-800" href={`/blog/page/${currentPage - 1}`}>Anterior</a>}
      {Array.from({ length: totalPages }).map((_, i) => {
        const p = i + 1;
        return p === currentPage
          ? <span class="px-3 py-2 rounded bg-blue-600 text-white">{p}</span>
          : <a class="px-3 py-2 rounded bg-gray-100 text-gray-800" href={`/blog/page/${p}`}>{p}</a>;
      })}
      {currentPage < totalPages && <a class="px-3 py-2 rounded bg-gray-200 text-gray-800" href={`/blog/page/${currentPage + 1}`}>Siguiente</a>}
    </nav>
  </main>
</LayoutBlog>