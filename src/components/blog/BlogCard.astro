---
const { post } = Astro.props;

const { slug, data } = post;

const { title, description, image, author, date, categories, tags, pin } = data

const dateObj = new Date(date)

// Formateamos la fecha al estilo "20 Nov 2025"
const dateFormatted = new Intl.DateTimeFormat('es-ES', {
  day: '2-digit',
  month: 'short',
  year: 'numeric'
}).format(dateObj);

const rawSource = post.body ?? "";
const textOnly = rawSource
  // eliminar bloques de cÃ³digo
  .replace(/```[\s\S]*?```/g, " ")
  // inline code backticks -> contenido
  .replace(/`([^`]+)`/g, " $1 ")
  // imÃ¡genes y links -> usar el texto alternativo/label
  .replace(/!\[.*?\]\(.*?\)/g, " ")
  .replace(/\[([^\]]+)\]\([^\)]+\)/g, " $1 ")
  // eliminar HTML tags
  .replace(/<[^>]+>/g, " ")
  // eliminar caracteres markdown residuales
  .replace(/[#>*_\-\r\n]/g, " ")
  // colapsar espacios
  .replace(/\s+/g, " ")
  .trim();

const wordsCount = textOnly ? textOnly.split(" ").filter(Boolean).length : 0;

// tiempo de lectura aproximado (200 wpm)
const readMinutes = Math.max(1, Math.ceil(wordsCount / 200));
---

<article data-category={categories[0]} class="group overflow-hidden rounded-xl border border-gray-200 dark:border-gray-800 bg-white/60 dark:bg-gray-900/60 shadow-sm hover:shadow-lg transition-transform duration-200 hover:-translate-y-1">
	<a href={`/blog/posts/${slug}`} class="block overflow-hidden">    
		<img src={`/${image.path}`} alt={title} class="w-full h-52 md:h-64 object-cover transition-transform duration-300 group-hover:scale-105" />
	</a>

	<div class="p-5">
		<div class="flex items-start justify-between mb-3">
			<small><a href=`/blog/categories/${categories[0]}` class="inline-block text-xs font-medium uppercase tracking-wide px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700">{categories[0]}</a></small>
		</div>
		{ pin ? <span class="text-xs text-yellow-400 ml-2">ðŸ“Œ</span> : null }
	
		<a href={`/blog/posts/${slug}`} class="block hover:underline">
			<h3 class="text-lg md:text-xl font-extrabold text-gray-900 dark:text-white leading-tight mb-2">{title}</h3>
		</a>
		<p class="text-sm text-gray-600 dark:text-gray-300 mb-4 line-clamp-3">{description}</p>

		<div class="flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400">
			<!-- { author ? <span class="font-medium text-gray-700 dark:text-gray-200">{author}</span> : null }
			<span>Â·</span>  -->
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-calendar"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 2a1 1 0 0 1 .993 .883l.007 .117v1h1a3 3 0 0 1 2.995 2.824l.005 .176v12a3 3 0 0 1 -2.824 2.995l-.176 .005h-12a3 3 0 0 1 -2.995 -2.824l-.005 -.176v-12a3 3 0 0 1 2.824 -2.995l.176 -.005h1v-1a1 1 0 0 1 1.993 -.117l.007 .117v1h6v-1a1 1 0 0 1 1 -1zm3 7h-14v9.625c0 .705 .386 1.286 .883 1.366l.117 .009h12c.513 0 .936 -.53 .993 -1.215l.007 -.16v-9.625z" /><path d="M12 12a1 1 0 0 1 .993 .883l.007 .117v3a1 1 0 0 1 -1.993 .117l-.007 -.117v-2a1 1 0 0 1 -.117 -1.993l.117 -.007h1z" /></svg>
			<time datetime={dateObj.toISOString()} class="text-gray-400">{dateFormatted}</time>
			<span>Â·</span>
			<span class="flex items-center gap-1">ðŸ•‘ <span class="text-gray-600 dark:text-gray-300">Lect. {readMinutes} min</span></span>
		</div>
	</div>
</article>
